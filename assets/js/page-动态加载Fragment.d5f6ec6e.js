(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{894:function(t,a,n){"use strict";n.r(a);var s=n(1),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"_1-步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-步骤"}},[t._v("#")]),t._v(" 1. 步骤")]),t._v(" "),n("h3",{attrs:{id:"_1-1-获取-fragmentmanager"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-获取-fragmentmanager"}},[t._v("#")]),t._v(" 1.1 获取 "),n("code",[t._v("FragmentManager")])]),t._v(" "),n("ul",[n("li",[t._v("当位于 "),n("code",[t._v("Activity")]),t._v(" 时，调用 "),n("code",[t._v("getFragmentManager()")]),t._v(" 方法即可获取到 "),n("code",[t._v("FragmentManager")]),t._v(" 实例")]),t._v(" "),n("li",[t._v("当位于 "),n("code",[t._v("Fragment")]),t._v(" 时，调用 "),n("code",[t._v("getActivity().getFragmentManager()")]),t._v(" 获取 "),n("code",[t._v("FragmentManager")]),t._v(" 实例")]),t._v(" "),n("li",[t._v("如果在 "),n("code",[t._v("Fragment")]),t._v(" 内层，即 "),n("code",[t._v("Fragment")]),t._v(" 的 "),n("code",[t._v("container")]),t._v(" 也是 "),n("code",[t._v("Fragment")]),t._v(" 时，调用 "),n("code",[t._v("getChildFragmentManager()")]),t._v(" 来获取 "),n("code",[t._v("FragmentManager")]),t._v(" 实例")])]),t._v(" "),n("blockquote",[n("p",[t._v("注意： "),n("code",[t._v("getChildFragmentManager()")]),t._v(" 仅用于两层 "),n("code",[t._v("FragmentManager")]),t._v(" 的时候。如果仅仅只是一层 "),n("code",[t._v("Fragment")]),t._v("，那么应该将 "),n("code",[t._v("Fragment")]),t._v(" 的切换操作回调到 "),n("code",[t._v("Activity")]),t._v(" 进行")])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// when in the activity")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FragmentManager")]),t._v(" fragmentManager "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFragmentManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// when in the fragment")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FragmentManager")]),t._v(" fragmentManager "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getActivity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFragmentManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// When in the nested fragment")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FragmentManager")]),t._v(" fragmentManager "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getChildFragmentManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])]),n("h3",{attrs:{id:"_1-2-调用-begintransaction-启动一个事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-调用-begintransaction-启动一个事务"}},[t._v("#")]),t._v(" 1.2 调用 "),n("code",[t._v("beginTransaction()")]),t._v(" 启动一个事务")]),t._v(" "),n("p",[t._v("这个方法是 "),n("code",[t._v("FragmentManager")]),t._v(" 的方法")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FragmentTransaction")]),t._v(" transcation "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fragmentManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("beginTransaction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("h3",{attrs:{id:"_1-3-将-fragment-加入到容器里面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-将-fragment-加入到容器里面"}},[t._v("#")]),t._v(" 1.3 将 "),n("code",[t._v("Fragment")]),t._v(" 加入到容器里面")]),t._v(" "),n("p",[t._v("我们有两种添加 "),n("code",[t._v("Fragment")]),t._v(" 的方法， "),n("code",[t._v("add()")]),t._v(" 和 "),n("code",[t._v("replace()")]),t._v("\n注意添加的时候带上 "),n("code",[t._v("tag")]),t._v(" 参数，以方便后面的弹出和返回。")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("使用 "),n("code",[t._v("replace()")]),t._v(" 方法")]),t._v(" "),n("p",[t._v("一般的，我们使用 "),n("code",[t._v("replace()")]),t._v(" 方法直接替换布局来将 "),n("code",[t._v("Fragment")]),t._v(" 添加到 容器里面")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fragment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("blockquote",[n("p",[n("code",[t._v("replace()")]),t._v(" 方法需要指定一个用于替换 "),n("code",[t._v("container")]),t._v(" 的 "),n("code",[t._v("Fragment")]),t._v(" 实例，同时还可以给其打上一个 "),n("code",[t._v("tag")]),t._v("（"),n("code",[t._v("String")]),t._v(" 类型的）来方便以后寻找。\n注意，"),n("code",[t._v("R.id.container")]),t._v("是 "),n("code",[t._v("Activity")]),t._v(" 布局中的一个 "),n("code",[t._v("layout")]),t._v(" 一般不将根布局替换，而是将其内部的一个子布局替换掉。\n例如下面的 xml，一般不替换根目录，而是上面的 "),n("code",[t._v("<RelativeLayout>")])])])])]),t._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("LinearLayout")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("android")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://schemas.android.com/apk/res/android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("layout_width")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("match_parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("layout_height")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("match_parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("fitsSystemWindows")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("orientation")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("vertical"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("layout")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("@layout/include_toolbar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("RelativeLayout")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("id")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("@+id/container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("layout_width")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("match_parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("layout_height")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("wrap_content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("LinearLayout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[n("code",[t._v("add()")]),t._v(" 方法")]),t._v(" "),n("p",[t._v("另外还有另一种添加 "),n("code",[t._v("Fragment")]),t._v(" 的方法 "),n("code",[t._v("add()")]),t._v("，与 "),n("code",[t._v("replace()")]),t._v(" 的调用方式相同，将 "),n("code",[t._v("replace()")]),t._v(" 替换成 "),n("code",[t._v("add()")]),t._v(" 即可\n一般来说，"),n("code",[t._v("add()")]),t._v(" 方法的效果和 "),n("code",[t._v("replace()")]),t._v(" 方法相同，但在一些情况下有所区别。")])])]),t._v(" "),n("h3",{attrs:{id:"_1-4-使用-commit-方法来提交事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-使用-commit-方法来提交事务"}},[t._v("#")]),t._v(" 1.4 使用 "),n("code",[t._v("commit()")]),t._v(" 方法来提交事务")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用这条语句来提交事务使得事务生效")]),t._v("\ntransaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当然也可以连着写。")]),t._v("\nfragmentManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("beginTransaction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n               "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("containe"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fragment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n               "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("blockquote",[n("p",[t._v("另外，还有一个 "),n("code",[t._v("commitAllowingStateLoss()")]),t._v(" 方法，关于这个方法和 "),n("code",[t._v("commit()")]),t._v(" 方法的区别和注意事项，在下面有所介绍")])]),t._v(" "),n("h2",{attrs:{id:"_2-补充部分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-补充部分"}},[t._v("#")]),t._v(" 2. 补充部分")]),t._v(" "),n("h3",{attrs:{id:"_2-1-添加-fragment-到返回栈"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-添加-fragment-到返回栈"}},[t._v("#")]),t._v(" 2.1 添加 Fragment 到返回栈")]),t._v(" "),n("p",[t._v("当有需要通过按返回键返回到上一个 Fragment 的时候，可以使用 "),n("code",[t._v("addToBackStack(null)")]),t._v(" 方法将当前的 Fragment 添加到返回栈中，此时通过按返回键即可回到上一个 Fragment。\n"),n("code",[t._v("addToBackStack()")]),t._v(" 方法还可以接受一个 "),n("code",[t._v("tag")]),t._v(" 作为参数，添加具有特定 tag 的 Fragment 进入返回栈。")]),t._v(" "),n("blockquote",[n("p",[n("code",[t._v("Fragment")]),t._v(" 的状态是最后离开这个 "),n("code",[t._v("Fragment")]),t._v(" 的状态，也就是说它会保留最后的 "),n("code",[t._v("Fragment")]),t._v(" 状态。")])]),t._v(" "),n("h3",{attrs:{id:"_2-2-add-和-replace-的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-add-和-replace-的区别"}},[t._v("#")]),t._v(" 2.2 "),n("code",[t._v("add()")]),t._v(" 和 "),n("code",[t._v("replace()")]),t._v(" 的区别")]),t._v(" "),n("ul",[n("li",[n("p",[n("code",[t._v("replace()")]),t._v(" 方法会"),n("strong",[t._v("删除当前的 Fragment")]),t._v(" 然后加入一个"),n("strong",[t._v("新的 Fragment")])]),t._v(" "),n("ul",[n("li",[t._v("当前仅会存在一个 "),n("code",[t._v("Fragment")]),t._v(" 在 "),n("code",[t._v("container")]),t._v(" 中")]),t._v(" "),n("li",[t._v("此方法会"),n("strong",[t._v("重新实例化 Fragment")])])])]),t._v(" "),n("li",[n("p",[n("code",[t._v("add()")]),t._v(" 方法只是添加了一个实例到 container 中，而不会删除当前的 Fragment 实例")]),t._v(" "),n("ul",[n("li",[t._v("当前有可能会存在多个 "),n("code",[t._v("Fragment")]),t._v(" 在 "),n("code",[t._v("container")]),t._v(" 中")]),t._v(" "),n("li",[t._v("此方法不会重新实例化 "),n("code",[t._v("Fragment")]),t._v("，"),n("strong",[t._v("当且仅当它没有被系统回收的时候")])])])]),t._v(" "),n("li",[n("p",[t._v("如何选用这两个方法")]),t._v(" "),n("ul",[n("li",[t._v("一般来说，它们的效果都是一样的，但是为了避免 "),n("code",[t._v("Layout")]),t._v(" 的冗余，我们一般使用 "),n("code",[t._v("replace()")])]),t._v(" "),n("li",[t._v("但是，当你需要在 "),n("code",[t._v("Fragment")]),t._v(" 的生命周期中启动一个"),n("strong",[t._v("异步任务")]),t._v("或者加载一些"),n("strong",[t._v("大量的资源文件")]),t._v("的时候，"),n("code",[t._v("replace()")]),t._v(" 的重新实例化特性会使得"),n("strong",[t._v("资源被大量的消耗")]),t._v("，所以在这种情况下，使用 "),n("code",[t._v("add()")])])])])]),t._v(" "),n("h3",{attrs:{id:"_2-3-提交事务的注意事项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-提交事务的注意事项"}},[t._v("#")]),t._v(" 2.3 提交事务的注意事项")]),t._v(" "),n("ol",[n("li",[n("p",[n("code",[t._v("IllegalStateException")]),t._v(" 异常")]),t._v(" "),n("blockquote",[n("p",[t._v("这个异常通常会在 "),n("code",[t._v("Activity")]),t._v(" 的状态保存之后，尝试去提交（即调用 "),n("code",[t._v("commit()")]),t._v(" 方法）一个 "),n("code",[t._v("FragmentTransaction")]),t._v(" 的时候发生，称为活动状态丢失（Activity State Loss）。\n这是由于系统会在活动在被挂起或销毁之前会将其当前状态保留为一个快照（例如用户按下 "),n("code",[t._v("Home")]),t._v(" 键），但是这个快照并没有将 "),n("code",[t._v("FragmentTransaction")]),t._v(" 作为活动的一部分保留，而是"),n("strong",[t._v("将其丢失")]),t._v("了，由于"),n("strong",[t._v("活动当前被销毁或挂起")]),t._v("，所以无法提交一个 "),n("code",[t._v("FragmentTransaction")])])]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("// 堆栈跟踪和异常代码\njava.lang.IllegalStateException:Can not perform this action after onSaveInstanceState\n    at android.support.v4.app.FragmentManagerImpl.checkStateLoss(FragmentManager.java:1341)\n    at android.support.v4.app.FragmentManagerImpl.enqueueAction(FragmentManager.java:1352)\n    at android.support.v4.app.BackStackRecord.commitInternal(BackStackRecord.java:595)\n    at android.support.v4.app.BackStackRecord.commit(BackStackRecord.java:574)\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])])]),t._v(" "),n("li",[n("p",[t._v("异常抛出的时间点")]),t._v(" "),n("blockquote",[n("p",[t._v("异常抛出的时间点通常和 "),n("code",[t._v("commit()")]),t._v(" 的被调用时间点是一致的，总结为下表")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("注：Honeycomb 即 3.0(API 11)")]),t._v(" "),n("th",[t._v("Honeycomb 之前的版本")]),t._v(" "),n("th",[t._v("Honeycomb 及更新的版本")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[n("code",[t._v("commit()")]),t._v(" 在 "),n("code",[t._v("onPause()")]),t._v(" 前被调用")]),t._v(" "),n("td",[t._v("OK")]),t._v(" "),n("td",[t._v("OK")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("commit()")]),t._v(" 在 "),n("code",[t._v("onPause()")]),t._v(" 和 "),n("code",[t._v("onStop()")]),t._v(" 执行中间被调用")]),t._v(" "),n("td",[t._v("STATE LOSS("),n("strong",[t._v("此时并没有异常")]),t._v(")")]),t._v(" "),n("td",[t._v("OK")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("commit()")]),t._v(" 在 "),n("code",[t._v("onStop()")]),t._v(" 之后被调用")]),t._v(" "),n("td",[t._v("EXCEPTION")]),t._v(" "),n("td",[t._v("EXCEPTION")])])])])]),t._v(" "),n("li",[n("p",[t._v("如何避免异常")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("谨慎的在除 "),n("code",[t._v("onCreate()")]),t._v(" 的其他生命周期函数中提交 "),n("code",[t._v("Transaction")])]),t._v(" "),n("blockquote",[n("p",[t._v("你必须保证 "),n("code",[t._v("Acitivity")]),t._v(" 被"),n("strong",[t._v("完全恢复之后")]),t._v("才能提交 "),n("code",[t._v("Transaction")]),t._v("。\n例如，你不应该在 "),n("code",[t._v("FragmentActivity")]),t._v(" 的 "),n("code",[t._v("onResume()")]),t._v(" 方法中提交 "),n("code",[t._v("Transactions")]),t._v("，有时候这个方法可能在 "),n("code",[t._v("Activity")]),t._v(" 被恢复前调用，你应该在 "),n("code",[t._v("onPostResume()")]),t._v(" 方法中提交，以保证 "),n("code",[t._v("Acitivity")]),t._v(" 完全恢复")])])]),t._v(" "),n("li",[n("p",[t._v("避免在异步回调函数中提交 "),n("code",[t._v("Transaction")])]),t._v(" "),n("blockquote",[n("p",[t._v("例如，应该避免在 "),n("code",[t._v("AsyncTask")]),t._v(" 的 "),n("code",[t._v("onPostExecute()")]),t._v(" 方法和 "),n("code",[t._v("LoaderManager.LoaderCallbacks")]),t._v(" 的 "),n("code",[t._v("onLoadFinished()")]),t._v(" 方法中提交 "),n("code",[t._v("Transaction")]),t._v("。由于它们都没有考虑到 "),n("code",[t._v("Activity")]),t._v(" 的实际状态，有可能在 "),n("code",[t._v("Activity")]),t._v(" 已经被结束之后仍然被调用。")])])]),t._v(" "),n("li",[n("p",[t._v("使用 "),n("code",[t._v("commitAllowingStateLoss()")]),t._v(" 方法")]),t._v(" "),n("blockquote",[n("p",[t._v("此方法和 "),n("code",[t._v("commit()")]),t._v(" 的唯一区别在于，当状态丢失出现的时候，其不会抛出一个异常。\n"),n("strong",[t._v("通常不应使用这个方法，除非状态丢失无可避免，否则就不应使用此方法")])])])])])])]),t._v(" "),n("h2",{attrs:{id:"_3-fragment-管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-fragment-管理"}},[t._v("#")]),t._v(" 3. Fragment 管理")]),t._v(" "),n("h3",{attrs:{id:"_3-1-返回到指定的-fragment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-返回到指定的-fragment"}},[t._v("#")]),t._v(" 3.1 返回到指定的 Fragment")]),t._v(" "),n("p",[t._v("当我们开启了太多的 "),n("code",[t._v("Fragment")]),t._v("，想回到指定的某个 "),n("code",[t._v("Fragment")]),t._v(" (比如说最开头的那一个) 时，使用 "),n("code",[t._v("popBackStack(String tag, int flags)")]),t._v(" 通过指定一个 "),n("code",[t._v("Fragment")]),t._v(" 的 "),n("code",[t._v("tag")]),t._v(" 来返回到指定的那个 Fragment；")]),t._v(" "),n("blockquote",[n("p",[t._v("第二个 flags 参数用来指定是否要将指定的 Fragment 也 pop 出去，此参数只能有两个值 "),n("code",[t._v("POP_BACK_STACK_INCLUSIVE")]),t._v(" 或者 "),n("code",[t._v("0")]),t._v("，如果指定了 "),n("code",[t._v("POP_BACK_STACK_INCLUSIVE")]),t._v(" 这个参数，那么就会将指定的 Fragment 也 pop 出去。")])]),t._v(" "),n("p",[t._v("注意事项：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("一般采用 "),n("code",[t._v("tag")]),t._v(" 参数来定位一个 "),n("code",[t._v("Fragment")])]),t._v(" "),n("blockquote",[n("p",[t._v("当使用 "),n("code",[t._v("add()")]),t._v(" 方法添加 "),n("code",[t._v("Fragment")]),t._v(" 时，因为一个 "),n("code",[t._v("ViewGroup")]),t._v(" 容器可以依附 "),n("code",[t._v("add()")]),t._v(" 多个Fragment，它们的 "),n("code",[t._v("id")]),t._v(" 自然是相同的。")])])]),t._v(" "),n("li",[n("p",[n("code",[t._v("popBackStack(null, FragmentManager.POP_BACK_STACK_INCLUSIVE)")]),t._v(" 的真正作用。")]),t._v(" "),n("blockquote",[n("p",[t._v("这个方法的官方文档似乎有一些错误（或者缺漏）\n由于第二个参数的存在，方法会在返回栈中寻找是否存在一个 "),n("code",[t._v("tag")]),t._v(" 为 "),n("code",[t._v("null")]),t._v(" 的 "),n("code",[t._v("Fragment")]),t._v("，显然，这是找不到的。\n"),n("strong",[t._v("所以，这个方法实际上会清空返回栈")])])])])]),t._v(" "),n("h3",{attrs:{id:"_3-2-在-fragment-之间切换"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-在-fragment-之间切换"}},[t._v("#")]),t._v(" 3.2 在 Fragment 之间切换")]),t._v(" "),n("h4",{attrs:{id:"_3-2-1-使用-add-show-hide-方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-使用-add-show-hide-方法"}},[t._v("#")]),t._v(" 3.2.1 使用 "),n("code",[t._v("add() show() hide()")]),t._v(" 方法")]),t._v(" "),n("blockquote",[n("p",[n("code",[t._v("FragmentPagerAdapter")]),t._v(" 采用这种模式，需要注意以下几种情况")])]),t._v(" "),n("ol",[n("li",[n("p",[t._v("只是显示和隐藏 "),n("code",[t._v("Fragment")]),t._v("，并不进入 "),n("code",[t._v("Fragment")]),t._v(" 生命周期")])]),t._v(" "),n("li",[n("p",[t._v("当隐藏的时候，"),n("code",[t._v("Fragment")]),t._v(" 仍然被激活，"),n("strong",[t._v("依旧会对点击事件作出反应")]),t._v("。")]),t._v(" "),n("blockquote",[n("p",[t._v("仍然会响应点击事件的原因在于，由于使用的是 add() 方法，所以当前 "),n("code",[t._v("container")]),t._v(" 会有"),n("strong",[t._v("多个 Fragment 实例")]),t._v("，然后 "),n("code",[t._v("show()")]),t._v(" 和 "),n("code",[t._v("hide()")]),t._v(" "),n("strong",[t._v("仅仅是将视图隐藏")]),t._v("了，"),n("code",[t._v("Fragment")]),t._v(" 实例依旧处于激活状态，所以会导致多个 Fragment 都会对点击事件做出响应。我们称为"),n("strong",[t._v("点击事件的泄露")])])]),t._v(" "),n("blockquote",[n("p",[t._v("此时，需要一些技巧防止点击事件的泄露")])]),t._v(" "),n("ol",[n("li",[n("p",[t._v("使用 "),n("code",[t._v("xml")]),t._v(" 截获点击事件")]),t._v(" "),n("blockquote",[n("p",[t._v("将 "),n("strong",[t._v("内层 Fragment")]),t._v(" 的"),n("strong",[t._v("根布局")]),t._v("设置为 "),n("code",[t._v('clickable="true"')]),t._v(" 即可")])]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"\n    android:layout_width="fill_parent"\n    android:layout_height="fill_parent"\n    android:clickable="true" />\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])])]),t._v(" "),n("li",[n("p",[t._v("使用 "),n("code",[t._v("java")]),t._v(" 截获点击事件")]),t._v(" "),n("blockquote",[n("p",[t._v("为"),n("strong",[t._v("根布局")]),t._v("设置 "),n("code",[t._v("OnTouchListener")]),t._v(" 并重载一个空方法，返回 "),n("code",[t._v("true")])])]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("@Override\npublic View onCreateView(LayoutInflater inflater,ViewGroup container,Bundle savedInstance){\n    View root;\n\n    /*here is an implementation*/\n\n    root.setOnTouchListener(new View.OnTouchListener() {\n        public boolean onTouch(View v, MotionEvent event) {\n            return true;\n        }\n    });\n    return root;\n}\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])])])])]),t._v(" "),n("li",[n("p",[t._v("解决 "),n("code",[t._v("Fragment already added")]),t._v(" 错误")]),t._v(" "),n("blockquote",[n("p",[t._v("在复杂的 "),n("code",[t._v("Fragment")]),t._v(" 管理中，经常会遇到 "),n("code",[t._v("Fragment already added")]),t._v(" 错误，所以每次在 "),n("code",[t._v("add Fragment")]),t._v(" 之前，首先要判断 "),n("code",[t._v("fragment.isAdded()")]),t._v(" 如果已经存在了那就不用再 "),n("code",[t._v("add()")]),t._v(" 了")])])]),t._v(" "),n("li",[n("p",[t._v("解决由于屏幕旋转或其他原因引起的 "),n("code",[t._v("Activity")]),t._v(" "),n("strong",[t._v("重构建")]),t._v("导致 "),n("code",[t._v("Fragment")]),t._v(" "),n("strong",[t._v("重复")]),t._v("问题")]),t._v(" "),n("blockquote",[n("p",[t._v("Android 系统中，Activity 可能在"),n("strong",[t._v("任何时刻")]),t._v("被"),n("strong",[t._v("不被通知地销毁和重建")]),t._v("，由此则会引起 Fragment 的重叠问题。\n可以通过检查是否存在 Activity 的快照 "),n("code",[t._v("savedInstanceState")]),t._v(" 来决定是否需要重新构建一个 Fragment 实例。\n如果存在 "),n("code",[t._v("savedInstanceState")]),t._v("，则不需要重新构建，只重新显示最后的当前 Fragment 即可")])])])]),t._v(" "),n("p",[t._v("这里是 "),n("code",[t._v("add()")]),t._v(" "),n("code",[t._v("show()")]),t._v(" "),n("code",[t._v("hide()")]),t._v(" 模式的代码：")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n* This way aims at resolve the following problem\n* 1. The reinstantiaiton of Fragment\n* 2. The Layout redundancy of multiple Fragment\n*/")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Check the Fragment isAdded. Aim to #1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("switchContent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Fragment")]),t._v(" from"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Fragment")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The mContent is the current fragment")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mContent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mContent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FragmentTransaction")]),t._v(" transaction "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mFragmentMan"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("beginTransaction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCustomAnimations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token class-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("anim"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fade_in"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("anim"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("slide_out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isAdded")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Judge if is added")]),t._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// if not added, hide the current Fragment and add the next to Activity")]),t._v("\n            transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hide")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("from"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content_frame"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//if added, just show the next.")]),t._v("\n            transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hide")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("from"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("show")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Check the saveInstance to avoid the activity reinstance. Aim to #2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" onCreate "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bundle")]),t._v(" savedInstanceState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("savedInstanceState "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFragmentManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("beginTransaction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UIFragment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Tag"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//if the instance does be recover,")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//use `findFragmentByTag()` to find the reference of the Fragment")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UIFragment")]),t._v(" fragment1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFragmentManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findFragmentById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fragment1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UIFragment")]),t._v(" fragment2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFragmentManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findFragmentByTag")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tag"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UIFragment")]),t._v(" fragment3 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//show one of them")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFragmentManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("beginTransaction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("show")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fragment1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hide")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fragment2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hide")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fragment3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hide")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br"),n("span",{staticClass:"line-number"},[t._v("49")]),n("br")])]),n("h4",{attrs:{id:"_3-2-2-使用-replace-方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-使用-replace-方法"}},[t._v("#")]),t._v(" 3.2.2 使用 "),n("code",[t._v("replace()")]),t._v(" 方法")]),t._v(" "),n("blockquote",[n("p",[n("code",[t._v("FragmentStatePageAdapter")]),t._v(" 采用这种模式")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("当前"),n("strong",[t._v("只会存在一个 fragment 实例")]),t._v("，简单的使用 "),n("code",[t._v("replace()")]),t._v(" 和 "),n("code",[t._v("popBackStack()")]),t._v(" 的重载方法即可在 "),n("code",[t._v("Fragment")]),t._v(" 之间进行切换")])]),t._v(" "),n("li",[n("p",[t._v("但是由于此方法在切换时"),n("strong",[t._v("每次都会重新构建 Fragment 实例")]),t._v("，如果需要从网络加载资源的话，会造成很多的网络流量损失和性能浪费。")])])]),t._v(" "),n("h4",{attrs:{id:"_3-2-3-比较和使用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-比较和使用场景"}},[t._v("#")]),t._v(" 3.2.3 比较和使用场景")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("如果管理 "),n("code",[t._v("Fragment")]),t._v(" 的开销比网络流量的开销要大，使用 "),n("code",[t._v("replace()")]),t._v(" 方法较好。")]),t._v(" "),n("blockquote",[n("p",[t._v("例如每次仅仅加载 几个k 或 几十b 的数据，就没有必要为了这点微不足道的流量节省从而进行复杂的 "),n("code",[t._v("Fragment")]),t._v(" 管理，一是加大开发难度，二是容易出现错误。")])])]),t._v(" "),n("li",[n("p",[t._v("如果在 Fragment 中需要加载大量的网络资源，或者进行十分耗时的资源加载工作（比如3D绘图），那么就应使用 "),n("code",[t._v("add()")]),t._v(" "),n("code",[t._v("show()")]),t._v(" "),n("code",[t._v("hide()")]),t._v(" 方法")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);